---
import MarkdownRenderer from './MarkdownRenderer.astro';
import type { SectionT } from '../utils/data';

export interface Props {
  section: SectionT;
}

const { section } = Astro.props;

import '../styles/section.css';

// Get section color for CSS variable
const sectionColor = section.color_primary || '#521d3a';

---

<section class="content">

  <div id="section-title" class={`section-title section-${section.sorting} mb-2`}>
    <h1 class="bg-primary px-2">
      {section.title}
    </h1>
    {section.icon && <img class="icon pl-2" src={section.icon.url} alt="icon" />}
  </div>
  {section.content && (
    <div class="section-body rounded p-3 color-bg-default">
      <div class="section-description">
        <MarkdownRenderer content={section.content} />
      </div>
    </div>
  )}
  {section.chapters && section.chapters.length > 0 && (
    <div class="chapters">
      {section.chapters
        .sort((a, b) => (a.sorting || 0) - (b.sorting || 0))
        .map(chapter => (
          <div id={chapter.slug} class="chapter">
            <h2>{chapter.title}</h2>
            <div class="chapter-content">
              <MarkdownRenderer content={chapter.content} />
            </div>
            {chapter.targets && chapter.targets.length > 0 && (
              <div class="targets">
                <h3>Zielgruppe</h3>
                <div class="targets-list">
                  {chapter.targets.map(target => (
                    <div class="target-item">
                      <span class="target-role">{target.role}</span>
                      <h4>{target.title}</h4>
                      <MarkdownRenderer content={target.content} />
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        ))}
    </div>
  )}

  <!-- Back to top button -->
  <button 
    id="back-to-top" 
    class="back-to-top" 
    onclick="document.getElementById('section-title')?.scrollIntoView({behavior: 'smooth'})"
    aria-label="Nach oben"
  >
    â†‘ Nach oben
  </button>
</section>



<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Check if there's a hash in the URL and scroll to it
    const hash = window.location.hash;
    if (hash) {
      const element = document.querySelector(hash);
      if (element) {
        setTimeout(() => {
          element.scrollIntoView({ behavior: 'smooth' });
        }, 100);
      }
    }

    // Show/hide back to top button based on scroll position
    const backToTopButton = document.getElementById('back-to-top');
    if (backToTopButton) {
      window.addEventListener('scroll', function() {
        if (window.scrollY > 300) {
          backToTopButton.style.display = 'block';
        } else {
          backToTopButton.style.display = 'none';
        }
      });

      // Initially hide the button
      backToTopButton.style.display = 'none';
    }
  });
</script>

<!-- Set section primary color -->
<style define:vars={{ sectionColor }}>
  :root {
    --color-primary: var(--sectionColor);
  }
</style>
