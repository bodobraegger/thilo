---
import MarkdownRenderer from './MarkdownRenderer.astro';
import type { SectionT } from '../utils/data';

export interface Props {
  section: SectionT;
}

const { section } = Astro.props;
---

<div class="content">
  <div id="section-title" class="section-title mb-2" style={`background-color: ${section.color_primary || '#0066cc'}`}>
    <h1 class="bg-primary px-2">{section.title}</h1>
  </div>

  <div class="section-body rounded p-2 color-bg-default">
    <div class="section-description">
      <MarkdownRenderer content={section.content} />
    </div>

    {section.chapters && section.chapters.length > 0 && (
      <div class="chapters">
        {section.chapters.map(chapter => (
          <div id={chapter.slug} class="chapter">
            <h2>{chapter.title}</h2>
            <div class="chapter-content">
              <MarkdownRenderer content={chapter.content} />
            </div>
            
            {chapter.targets && chapter.targets.length > 0 && (
              <div class="targets">
                <h3>Zielgruppe</h3>
                <div class="targets-list">
                  {chapter.targets.map(target => (
                    <div class="target-item">
                      <span class="target-role">{target.role}</span>
                      <h4>{target.title}</h4>
                      <MarkdownRenderer content={target.content} />
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        ))}
      </div>
    )}
  </div>

  <!-- Back to top button -->
  <button 
    id="back-to-top" 
    class="back-to-top" 
    onclick="document.getElementById('section-title')?.scrollIntoView({behavior: 'smooth'})"
    aria-label="Nach oben"
  >
    â†‘ Nach oben
  </button>
</div>

<style lang="scss">
  .section-title {
    margin-bottom: 1.5rem;

    h1 {
      background-color: var(--color-primary, #0066cc);
      color: white;
      padding: 1rem 1.5rem;
      margin: 0;
      border-radius: 0.5rem;
      font-size: 2rem;
    }
  }

  .section-body {
    background-color: var(--color-bg-secondary, #f8f9fa);
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-bottom: 2rem;
  }

  .chapters {
    margin-top: 2rem;
  }

  .chapter {
    margin-bottom: 3rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--color-border-muted, #e9ecef);

    &:last-child {
      border-bottom: none;
    }

    h2 {
      color: var(--color-primary-dark, #004499);
      font-size: 1.75rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--color-primary, #0066cc);
    }

    .chapter-content {
      margin-bottom: 1.5rem;
    }
  }

  .targets {
    background-color: var(--color-bg-tertiary, #e9ecef);
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-top: 1.5rem;

    h3 {
      color: var(--color-primary-dark, #004499);
      margin-bottom: 1rem;
      font-size: 1.25rem;
    }

    .targets-list {
      display: grid;
      gap: 1rem;
    }

    .target-item {
      background-color: white;
      padding: 1rem;
      border-radius: 0.375rem;
      border-left: 4px solid var(--color-primary, #0066cc);

      .target-role {
        display: inline-block;
        background-color: var(--color-primary, #0066cc);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.875rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      h4 {
        margin: 0.5rem 0;
        color: var(--color-text-primary, #212529);
        font-size: 1.125rem;
      }
    }
  }

  .back-to-top {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background-color: var(--color-primary, #0066cc);
    color: white;
    border: none;
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 600;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.2s ease;
    z-index: 1000;

    &:hover {
      background-color: var(--color-primary-dark, #004499);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    @media (max-width: 768px) {
      bottom: 1rem;
      right: 1rem;
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
    }
  }

  @media (max-width: 768px) {
    .section-title h1 {
      font-size: 1.5rem;
      padding: 0.75rem 1rem;
    }

    .section-body {
      padding: 1rem;
    }

    .chapter h2 {
      font-size: 1.5rem;
    }

    .targets {
      padding: 1rem;
    }
  }
</style>

<script>
  // Handle scroll to chapter functionality
  document.addEventListener('DOMContentLoaded', function() {
    // Check if there's a hash in the URL and scroll to it
    const hash = window.location.hash;
    if (hash) {
      const element = document.querySelector(hash);
      if (element) {
        setTimeout(() => {
          element.scrollIntoView({ behavior: 'smooth' });
        }, 100);
      }
    }

    // Show/hide back to top button based on scroll position
    const backToTopButton = document.getElementById('back-to-top');
    if (backToTopButton) {
      window.addEventListener('scroll', function() {
        if (window.scrollY > 300) {
          backToTopButton.style.display = 'block';
        } else {
          backToTopButton.style.display = 'none';
        }
      });

      // Initially hide the button
      backToTopButton.style.display = 'none';
    }
  });
</script>
