---
import { getTranslations, type Locale } from '../i18n';
import { getSectionUrlForLocale } from '../utils/slugMapping';

import '../styles/footer.css';

export interface Props {
  locale?: Locale;
  currentSection?: any;
}

const { locale = 'de', currentSection } = Astro.props;
const t = getTranslations(locale);

// Get all sections from API using utility
import { getSections } from '../utils/data';
import type { SectionT } from '../utils/data';
let sections: SectionT[] = [];
try {
  sections = await getSections(locale);
} catch (e) {
  sections = [];
}

// Get current section slug from URL
const url = Astro.url;
let currentSectionSlug = url.pathname.replace(/^\/(de|fr|it)\//, '').replace(/^\//, '');

let prevSection = null, nextSection = null;
if (sections && currentSectionSlug) {
  for (let i = 0; i < sections.length; i++) {
    if (sections[i].slug === currentSectionSlug) {
      if (i > 0) prevSection = sections[i - 1];
      if (i < sections.length - 1) nextSection = sections[i + 1];
    }
  }
} else if (sections && sections[0]) {
  nextSection = sections[0];
  prevSection = sections[sections.length - 1];
}


const prevSlug = prevSection ? String(prevSection.slug) : '';
const nextSlug = nextSection ? String(nextSection.slug) : '';

function getSectionUrl(slug: string) {
  if (!slug) return locale === 'de' ? '/' : `/${locale}/`;
  return locale === 'de' ? `/${slug}` : `/${locale}/${slug}`;
}

// Fallback navigation button texts (could be localized in translation files)
const prevButtonText = {
  de: 'Vorheriges Kapitel',
  fr: 'Chapitre précédent',
  it: 'Capitolo precedente',
}[locale] || 'Previous';
const nextButtonText = {
  de: 'Nächstes Kapitel',
  fr: 'Chapitre suivant',
  it: 'Capitolo successivo',
}[locale] || 'Next';
const homeButtonText = {
  de: 'Zur Übersicht',
  fr: 'Accueil',
  it: 'Home',
}[locale] || 'Home';
---


<footer data-container="footer" class="mb-3">
  <nav class="footer-nav d-flex flex-justify-between">
    {prevSection || nextSection ? (
      <>
        <a href={getSectionUrl(prevSlug)} class="btn-nav btn-footer px-sm-2 px-md-3 py-5">
          {prevSection ? (
            <>
              {prevButtonText}<br />
              <i>{prevSection.title}</i>
            </>
          ) : (
            <>
              {homeButtonText}<br />&nbsp;
            </>
          )}
        </a>
        <a href={getSectionUrl(nextSlug)} class="btn-nav btn-footer px-sm-2 px-md-3 py-5">
          {nextSection ? (
            <>
              {nextButtonText}<br />
              <i>{nextSection.title}</i>
            </>
          ) : (
            <>
              {homeButtonText}<br />&nbsp;
            </>
          )}
        </a>
      </>
    ) : (
      <a href={getSectionUrl(prevSlug)} class="btn-nav btn-footer">
        {homeButtonText}
      </a>
    )}
  </nav>
</footer>
