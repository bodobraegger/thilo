---
import { getTranslations, type Locale } from "../i18n";
import { getSectionUrlForLocale } from "../utils/slugMapping";

import "../styles/footer.css";

export interface Props {
    locale?: Locale;
    currentSection?: any;
}

const { locale = "de", currentSection } = Astro.props;
const t = getTranslations(locale);

// Get all sections from API using utility
import { getSections } from "../utils/data";
import type { SectionT } from "../utils/data";
let sections: SectionT[] = [];
try {
    sections = await getSections(locale);
} catch (e) {
    sections = [];
}
const currentSectionSlug = currentSection ? currentSection.slug : null;

let prevSection = null,
    nextSection = null;
if (sections && currentSectionSlug) {
    for (let i = 0; i < sections.length; i++) {
        if (sections[i].slug === currentSectionSlug) {
            if (i > 0) prevSection = sections[i - 1];
            if (i < sections.length - 1) nextSection = sections[i + 1];
        }
    }
} else if (sections && sections[0]) {
    nextSection = sections[0];
    prevSection = sections[sections.length - 1];
}

const prevSlug = prevSection ? String(prevSection.slug) : "";
const nextSlug = nextSection ? String(nextSection.slug) : "";

function getSectionUrl(slug: string) {
    if (!slug) return locale === "de" ? "/" : `/${locale}/`;
    return locale === "de" ? `/${slug}` : `/${locale}/${slug}`;
}

// Fallback navigation button texts (could be localized in translation files)
const prevButtonText =
    {
        de: "Vorheriges Kapitel",
        fr: "Chapitre précédent",
        it: "Capitolo precedente",
    }[locale] || "Previous";
const nextButtonText =
    {
        de: "Nächstes Kapitel",
        fr: "Chapitre suivant",
        it: "Capitolo successivo",
    }[locale] || "Next";
const homeButtonText =
    {
        de: "Zur Übersicht",
        fr: "Accueil",
        it: "Home",
    }[locale] || "Home";
---


<footer data-container="footer" class="mb-3">
  <nav class="footer-nav flex justify-between items-center mt-6">
    {prevSection && (
      <a
        href={getSectionUrl(prevSlug)}
        class="btn-footer"
      >
        <svg aria-hidden="true" focusable="false" class="octicon octicon-arrow-left" viewBox="0 0 16 16" width="20" height="20" fill="currentColor">
          <path d="M7.78 12.53a.75.75 0 0 1-1.06 0L2.47 8.28a.75.75 0 0 1 0-1.06l4.25-4.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042L4.81 7h7.44a.75.75 0 0 1 0 1.5H4.81l2.97 2.97a.75.75 0 0 1 0 1.06Z" />
        </svg>
        <div class="label">
          <span>{prevButtonText || "Previous chapter"}</span>
          <span><i>{prevSection.title}</i></span>
        </div>
      </a>
    )}

    {nextSection && (
      <a
        href={getSectionUrl(nextSlug)}
        class="btn-footer"
      >
        <div class="label">
          <span>{nextButtonText || "Next chapter"}</span>
          <span class="footer-btn-title"><i>{nextSection.title}</i></span>
        </div>
        <svg aria-hidden="true" focusable="false" class="octicon octicon-arrow-right" viewBox="0 0 16 16" width="20" height="20" fill="currentColor">
          <path d="M8.22 2.97a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l2.97-2.97H3.75a.75.75 0 0 1 0-1.5h7.44L8.22 4.03a.75.75 0 0 1 0-1.06Z" />
        </svg>
      </a>
    )}
  </nav>

</footer>
