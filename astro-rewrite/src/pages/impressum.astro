---
import MainLayoutWithToC from '../layouts/MainLayoutWithToC.astro';
import { getTranslations } from '../i18n';
import MarkdownRenderer from '../components/MarkdownRenderer.astro';

const locale = Astro.currentLocale || 'de';
const t = getTranslations(locale as any);

// Fetch impressum content from Strapi
async function fetchImpressum(locale: string) {
  try {
    const response = await fetch(`https://api.thilo.scouts.ch/impressum-page?locale=${locale}`);
    
    if (!response.ok) {
      console.error(`Failed to fetch impressum: ${response.status} ${response.statusText}`);
      return null;
    }
    
    const data = await response.json();
    console.log('Impressum data:', data); // Debug log
    
    // Handle both single object and data.data.attributes structure
    if (data?.data?.attributes) {
      return data.data.attributes;
    } else if (data?.id) {
      // Direct object response
      return data;
    }
    
    return null;
  } catch (error) {
    console.error('Error fetching impressum:', error);
    return null;
  }
}

const impressumData = await fetchImpressum(locale);
console.log('Final impressum data:', impressumData); // Debug log
---

<MainLayoutWithToC title={impressumData?.title ? impressumData.title + " - Thilo" : t.translation.header.imprint + " - Thilo"} lang={locale}>
  <div class="content">
    <div class="section-title mb-2">
      <h1 class="bg-primary px-2">{impressumData?.title || t.translation.header.imprint}</h1>
    </div>

    <div class="section-body rounded p-2 color-bg-default">
      <div class="impressum-content">
        {impressumData ? (
          <MarkdownRenderer content={impressumData.content || ''} />
        ) : (
          <p>Impressum content could not be loaded.</p>
        )}
      </div>
    </div>
  </div>
</MainLayoutWithToC>
