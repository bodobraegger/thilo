---
import MainLayoutWithToC from '../../layouts/MainLayoutWithToC.astro';
import Section from '../../components/Section.astro';
import { getSections } from '../../utils/data';
import { getAllSlugsForSection } from '../../utils/slugMapping';
import { slugify } from '../../utils/slugify';

export async function getStaticPaths() {
  const locale = 'it';
  const paths = [];
  
  try {
    const sections = await getSections(locale);
    for (const section of sections) {
      const sectionId = section.id.toString();
      // Get all possible slugs for this section
      const slugVariants = getAllSlugsForSection(sectionId);
      const italianSlug = slugVariants.find(s => s.locale === 'it')?.slug;
      
      if (italianSlug) {
        paths.push({
          params: { slug: italianSlug },
          props: { section, locale }
        });
      } else {
        // Fallback: also try to create routes with the generated slug
        paths.push({
          params: { slug: section.slug },
          props: { section, locale }
        });
      }
    }
  } catch (error) {
    console.error(`Error loading sections for ${locale}:`, error);
  }
  

  return paths;
}

const { section, locale } = Astro.props;

if (!section) {
  return Astro.redirect('/404');
}
---

<MainLayoutWithToC title={section.title} lang={locale} currentSection={section}>
  <Section section={section} />
</MainLayoutWithToC>
